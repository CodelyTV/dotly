#!/usr/bin/env bash

set -uo pipefail

source "$DOTLY_PATH/scripts/core/_main.sh"
source "$DOTLY_PATH/scripts/package/src/package_managers/brew.sh"
source "$DOTLY_PATH/scripts/package/src/package_managers/cargo.sh"
source "$DOTLY_PATH/scripts/package/src/package_managers/composer.sh"
source "$DOTLY_PATH/scripts/package/src/package_managers/gem.sh"
source "$DOTLY_PATH/scripts/package/src/package_managers/mas.sh"
source "$DOTLY_PATH/scripts/package/src/package_managers/npm.sh"
source "$DOTLY_PATH/scripts/package/src/package_managers/pip.sh"

##? Update all packages
##?
##? Usage:
##?   update_all
docs::parse "$@"

output::h1_without_margin "â™»ï¸  Updating all the apps on your system"
output::write "If you want to debug what's happening behind the scenes, you can execute \`dot self debug\` in parallel."

platform::command_exists mas && output::h2 'ğŸ App Store' && mas::update_all
platform::command_exists brew && output::h2 'ğŸº Brew' && brew::update_all
platform::command_exists pip3 && output::h2 'ğŸ pip' && pip::update_all
platform::command_exists composer && output::h2 'ğŸ˜ Composer' && composer::update_all
platform::command_exists gem && output::h2 'â™¦ï¸  gem' && gem::update_all
platform::command_exists npm && output::h2 'ğŸŒˆ npm' && npm::update_all
platform::command_exists cargo && output::h2 'ğŸ“¦ cargo' && cargo::update_all

platform::command_exists tldr && output::h2 'ğŸ“œ tldr database' && tldr --update >/dev/null 2>&1 && output::answer "Database updated"

output::h2 "ğŸ‘½ Zim Framework" && zsh "$ZIM_HOME/zimfw.zsh" upgrade 2>&1 | log::file "Upgrading Zim" && zsh "$ZIM_HOME/zimfw.zsh" update 2>&1 | log::file "Updating Zim" && output::answer "Done"

output::h2 "ğŸŒš dotly completions" && dot shell zsh reload_completions >/dev/null 2>&1 && output::answer "Done"

output::empty_line
output::write 'ğŸ‘Œ All your packages have been successfully updated'
